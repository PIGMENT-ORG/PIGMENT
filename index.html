<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIGMENT ‚Äî Evolutionary Painter</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Additional styles for new UI */
        #evolved-panel { display: none; } /* Hidden by default */
        .strategy-box {
            background: #0c0c0a;
            border: 1px solid #1e1c14;
            border-radius: 6px;
            padding: 12px 16px;
            width: 100%;
            max-width: 800px;
            margin: 10px 0;
        }
        .strategy-box h3 {
            font-family: Georgia, serif;
            font-size: 0.9em;
            color: #7a6840;
            margin-bottom: 8px;
        }
        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            font-size: 0.85em;
        }
        .strategy-label { color: #5a5440; }
        .strategy-value { color: #c0b080; font-weight: bold; }
        .toggle-btn {
            background: #1a1a14;
            border: 1px solid #c8a838;
            color: #e8d080;
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        .toggle-btn:hover {
            background: #2a2818;
        }
        /* Hide all manual controls */
        .manual-controls { display: none; }
    </style>
</head>
<body>
    <h1>üé® PIGMENT</h1>
    <div class="sub">SELF-LEARNING AI ¬∑ 2,286 TRAINING SAMPLES ¬∑ AUTO-STRATEGY</div>

    <div id="dropzone">
        <div class="drop-icon">üñºÔ∏è</div>
        <div><strong>Drop image here</strong> or click to browse</div>
    </div>
    <input type="file" id="fi" accept="image/*" hidden>

    <div id="pgLoader">
        <div class="drop-icon">üß¨</div>
        <div><strong>Load .pg genome</strong> or paste (Ctrl+V)</div>
    </div>
    <input type="file" id="pgFile" accept=".pg" hidden>

    <!-- Simplified Controls -->
    <div class="controls">
        <button class="go" id="bstart" disabled>‚ñ∂ START</button>
        <button id="bpause" disabled>‚è∏ PAUSE</button>
        <button id="breset" disabled>‚Ü∫ RESET</button>
        <button id="bstep" disabled>‚è© STEP</button>
        <button id="exportPG" class="toggle-btn">üì§ EXPORT</button>
        <button id="toggleEvolved" class="toggle-btn" onclick="toggleEvolved()">üëÅÔ∏è Show Evolved</button>
    </div>

    <!-- All manual controls hidden (algorithm decides everything) -->
    <div class="manual-controls" style="display: none;">
        <!-- Kept for reference but hidden -->
        <select id="selpoly"><option value="50">50</option></select>
        <select id="selspd"><option value="20">20</option></select>
        <input type="range" id="rsize" value="4">
        <select id="algorithm"><option value="multi">Multi</option></select>
        <input type="range" id="mutRate" value="1.0">
        <input type="range" id="temperature" value="1.0">
        <input type="checkbox" id="showOutlines">
        <input type="checkbox" id="overlayDiff">
        <input type="checkbox" id="sizePenalty" checked>
        <input type="checkbox" id="edgeWeight" checked>
        <input type="checkbox" id="useFaceDetect" checked>
        <input type="checkbox" id="useSymmetry" checked>
        <input type="checkbox" id="useSkinTone" checked>
        <input type="checkbox" id="useEdges" checked>
        <select id="exportScale"><option value="2">2√ó</option></select>
        <input type="checkbox" id="embedMeta">
    </div>

    <!-- Canvas Panels - TARGET and DIFF only, EVOLVED hidden -->
    <div class="panels">
        <div class="panel"><div class="plabel">üéØ TARGET</div><canvas id="cvt" width="200" height="200"></canvas></div>
        <div class="panel"><div class="plabel">üìä DIFF</div><canvas id="cvd" width="200" height="200"></canvas></div>
        <div class="panel" id="evolved-panel"><div class="plabel">üß¨ EVOLVED</div><canvas id="cve" width="200" height="200"></canvas></div>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
        <div class="stat-item"><span class="sv" id="sg">0</span><span class="sl">GENERATIONS</span></div>
        <div class="stat-item"><span class="sv" id="sf">0.00%</span><span class="sl">PIXEL</span></div>
        <div class="stat-item"><span class="sv" id="ss">0.00</span><span class="sl">STRUCTURE</span></div>
        <div class="stat-item"><span class="sv" id="si">0</span><span class="sl">IMPROVEMENTS</span></div>
        <div class="stat-item"><span class="sv" id="sr">0/s</span><span class="sl">SPEED</span></div>
        <div class="stat-item"><span class="sv" id="stime">0:00</span><span class="sl">TIME</span></div>
        <div class="stat-item"><span class="sv" id="seta">--:--</span><span class="sl">ETA</span></div>
        <div class="stat-item"><span class="sv" id="speak">0%</span><span class="sl">PEAK</span></div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    <canvas id="crv"></canvas>

    <!-- AI Strategy Display -->
    <div class="strategy-box">
        <h3>üß† ALGORITHM DECISIONS (based on 2,286 training samples)</h3>
        <div class="strategy-grid">
            <div><span class="strategy-label">Strategy:</span> <span class="strategy-value" id="ai-strategy">Analyzing...</span></div>
            <div><span class="strategy-label">Image type:</span> <span class="strategy-value" id="ai-type">--</span></div>
            <div><span class="strategy-label">Polygons:</span> <span class="strategy-value" id="ai-polygons">auto</span></div>
            <div><span class="strategy-label">Speed:</span> <span class="strategy-value" id="ai-speed">auto</span></div>
            <div><span class="strategy-label">Mutation bias:</span> <span class="strategy-value" id="ai-bias">Scale +0.63</span></div>
            <div><span class="strategy-label">Confidence:</span> <span class="strategy-value" id="ai-confidence">98%</span></div>
        </div>
    </div>

    <!-- Current Genome Display (kept) -->
    <div class="expbox">
        <h3>üß¨ CURRENT GENOME</h3>
        <textarea id="pg-out" readonly placeholder="Genome will appear here..."></textarea>
    </div>

    <div id="alert-area"></div>

    <!-- All your existing script includes (unchanged) -->
    <script src="js/utils/geometry.js"></script>
    <script src="js/utils/color-utils.js"></script>
    <script src="js/utils/image-utils.js"></script>
    <script src="js/utils/performance.js"></script>
    <script src="js/intelligence/face-detector.js"></script>
    <script src="js/intelligence/symmetry-analyzer.js"></script>
    <script src="js/intelligence/skin-tone-detector.js"></script>
    <script src="js/intelligence/edge-importance.js"></script>
    <script src="js/intelligence/composition-rules.js"></script>
    <script src="js/intelligence/visual-intelligence.js"></script>
    <script src="js/mutations/base-mutation.js"></script>
    <script src="js/mutations/translate-mutation.js"></script>
    <script src="js/mutations/scale-mutation.js"></script>
    <script src="js/mutations/rotate-mutation.js"></script>
    <script src="js/mutations/color-mutation.js"></script>
    <script src="js/mutations/opacity-mutation.js"></script>
    <script src="js/mutations/intelligent-mutation.js"></script>
    <script src="js/mutations/index.js"></script>
    <script src="js/fitness/pixel-fitness.js"></script>
    <script src="js/fitness/structural-fitness.js"></script>
    <script src="js/fitness/semantic-fitness.js"></script>
    <script src="js/fitness/multi-objective.js"></script>
    <script src="js/export/pg-exporter.js"></script>
    <script src="js/export/pg-parser.js"></script>
    <script src="js/export/image-exporter.js"></script>
    <script src="js/ui/controls.js"></script>
    <script src="js/ui/stats-display.js"></script>
    <script src="js/ui/progress-bar.js"></script>
    <script src="js/ui/fitness-curve.js"></script>
    <script src="js/ui/alert-system.js"></script>
    <script src="js/supabase-client.js"></script>
    <script src="js/core/canvas-manager.js"></script>
    <script src="js/core/evolution-engine.js"></script>
    <script src="js/core/pigment.js"></script>

    <script>
        // Toggle Evolved panel
        function toggleEvolved() {
            const panel = document.getElementById('evolved-panel');
            const btn = document.getElementById('toggleEvolved');
            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'block';
                btn.textContent = 'üëÅÔ∏è Hide Evolved';
            } else {
                panel.style.display = 'none';
                btn.textContent = 'üëÅÔ∏è Show Evolved';
            }
        }

        // Update AI decisions based on RL data
        function updateAIDecisions() {
            // These will be populated from your RL system
            if (window.Pigment && window.Pigment.evolution) {
                const stats = window.Pigment.evolution.getStats();
                const intelligence = window.Pigment.intelligence;
                
                document.getElementById('ai-strategy').textContent = 
                    stats.fitness > 60 ? 'Fine-tuning phase' : 'Exploration phase';
                document.getElementById('ai-type').textContent = 
                    intelligence?.face ? 'Portrait detected' : 'General image';
                document.getElementById('ai-polygons').textContent = 
                    stats.polygons + ' (auto)';
                document.getElementById('ai-speed').textContent = 
                    Math.round(stats.generations / Math.max(1, performance.now()/1000)) + ' gen/s';
                document.getElementById('ai-bias').textContent = 
                    'Scale +0.63';
                document.getElementById('ai-confidence').textContent = 
                    Math.round(stats.fitness) + '%';
            }
        }

        // Wire up drop zones
        const dz = document.getElementById('dropzone');
        dz.addEventListener('click', () => document.getElementById('fi').click());
        dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('over'); });
        dz.addEventListener('dragleave', () => dz.classList.remove('over'));
        dz.addEventListener('drop', e => {
            e.preventDefault(); dz.classList.remove('over');
            if (e.dataTransfer.files[0] && window.Pigment) Pigment.loadImage(e.dataTransfer.files[0]);
        });

        const pgdz = document.getElementById('pgLoader');
        pgdz.addEventListener('click', () => document.getElementById('pgFile').click());
        pgdz.addEventListener('dragover', e => { e.preventDefault(); pgdz.classList.add('over'); });
        pgdz.addEventListener('dragleave', () => pgdz.classList.remove('over'));
        pgdz.addEventListener('drop', e => {
            e.preventDefault(); pgdz.classList.remove('over');
            if (e.dataTransfer.files[0] && window.Pigment) Pigment.loadPG(e.dataTransfer.files[0]);
        });

        // Export button handler
        document.getElementById('exportPG').addEventListener('click', () => {
            if (window.Pigment) Pigment.exportPG();
        });

        // Update AI decisions every second
        setInterval(updateAIDecisions, 1000);
    </script>
</body>
</html>