<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIGMENT ‚Äî AI Training Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #080806;
            color: #c0b898;
            font-family: 'Courier New', monospace;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        h1 {
            font-family: Georgia, serif;
            font-size: 2em;
            color: #e8d898;
        }

        .sub {
            color: #5a5440;
            margin-bottom: 20px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1200px;
            width: 100%;
        }

        .card {
            background: #0c0c0a;
            border: 1px solid #2a2818;
            border-radius: 8px;
            padding: 20px;
        }

        .card h2 {
            color: #b8a878;
            font-size: 1.2em;
            margin-bottom: 15px;
            border-bottom: 1px solid #2a2818;
            padding-bottom: 5px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #1a1810;
        }

        .stat-label {
            color: #7a6840;
        }

        .stat-value {
            color: #e8d898;
            font-weight: bold;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #1a1810;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: #c8a838;
            width: 0%;
            transition: width 0.3s;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .feature-item {
            background: #141210;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #c8a838;
        }

        .feature-name {
            font-size: 0.7em;
            color: #7a6840;
        }

        .feature-value {
            font-size: 1.2em;
            color: #e8d898;
        }

        .btn {
            background: #141210;
            border: 1px solid #3a3828;
            color: #b8a878;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9em;
            margin: 5px;
        }

        .btn:hover {
            background: #1e1c14;
            border-color: #c8a838;
            color: #e8d080;
        }

        .btn-primary {
            background: #1a2818;
            border-color: #a0c080;
            color: #d8f0c0;
        }

        .chart-container {
            height: 200px;
            margin: 15px 0;
            position: relative;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            gap: 10px;
            height: 150px;
            margin-top: 10px;
        }

        .bar {
            flex: 1;
            background: #c8a838;
            min-width: 20px;
            transition: height 0.3s;
        }

        .bar-label {
            text-align: center;
            font-size: 0.7em;
            color: #7a6840;
            margin-top: 5px;
        }

        .alert {
            background: #2a2010;
            border: 1px solid #c8a838;
            color: #e8d080;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .model-info {
            background: #141210;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }

        @media (max-width: 600px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>üß† PIGMENT AI Training Dashboard</h1>
    <div class="sub">Real-time training metrics ¬∑ Policy network ¬∑ Feature importance</div>

    <div class="dashboard-grid">
        <!-- Training Stats Card -->
        <div class="card">
            <h2>üìä Training Statistics</h2>
            <div class="stat-row">
                <span class="stat-label">Total Samples:</span>
                <span class="stat-value" id="sampleCount">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Training Files:</span>
                <span class="stat-value" id="fileCount">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Last Updated:</span>
                <span class="stat-value" id="lastUpdate">--:--</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Model Version:</span>
                <span class="stat-value" id="modelVersion">v5.0</span>
            </div>
            
            <div class="progress-bar" style="margin-top:15px;">
                <div class="progress-fill" id="trainingProgress" style="width: 0%"></div>
            </div>
            <div style="display:flex; justify-content:space-between;">
                <span>Training Progress</span>
                <span id="progressPercent">0%</span>
            </div>
        </div>

        <!-- Model Performance Card -->
        <div class="card">
            <h2>üéØ Model Performance</h2>
            <div class="stat-row">
                <span class="stat-label">Accuracy (R¬≤):</span>
                <span class="stat-value" id="modelAccuracy">0.00</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Best SSIM:</span>
                <span class="stat-value" id="bestSsim">0.000</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">MSE:</span>
                <span class="stat-value" id="modelMse">0.000</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">CV Score:</span>
                <span class="stat-value" id="cvScore">0.00</span>
            </div>
            
            <div class="model-info">
                <div style="color:#a0c080; margin-bottom:5px;">üß† Policy Network</div>
                <div style="font-size:0.8em; color:#7a6840;">Random Forest ¬∑ 100 trees ¬∑ max_depth=10</div>
            </div>
        </div>

        <!-- Feature Importance Card -->
        <div class="card">
            <h2>üîç Feature Importance</h2>
            <div class="chart-container">
                <div class="bar-chart" id="featureChart"></div>
            </div>
            <div class="feature-grid" id="featureList">
                <!-- Populated by JavaScript -->
            </div>
        </div>

        <!-- Parameter Prediction Card -->
        <div class="card">
            <h2>‚ö° Optimal Parameters</h2>
            <div class="feature-grid">
                <div class="feature-item">
                    <div class="feature-name">craquelure.density</div>
                    <div class="feature-value" id="param1">0.2</div>
                </div>
                <div class="feature-item">
                    <div class="feature-name">sss.radius</div>
                    <div class="feature-value" id="param2">0.3</div>
                </div>
                <div class="feature-item">
                    <div class="feature-name">sfumato.kernel</div>
                    <div class="feature-value" id="param3">0.4</div>
                </div>
                <div class="feature-item">
                    <div class="feature-name">illumination.weight</div>
                    <div class="feature-value" id="param4">0.7</div>
                </div>
                <div class="feature-item">
                    <div class="feature-name">age_shift.intensity</div>
                    <div class="feature-value" id="param5">0.4</div>
                </div>
                <div class="feature-item">
                    <div class="feature-name">color_temp.offset</div>
                    <div class="feature-value" id="param6">0.5</div>
                </div>
            </div>
            <button class="btn btn-primary" style="width:100%; margin-top:15px;" onclick="retrainModel()">
                üîÑ Retrain Model
            </button>
        </div>
    </div>

    <!-- Action Buttons -->
    <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin:20px 0;">
        <button class="btn" onclick="loadTrainingData()">üìÇ Load Training Data</button>
        <button class="btn" onclick="exportModel()">üì§ Export Model</button>
        <button class="btn" onclick="runInference()">üé® Run Inference</button>
        <button class="btn" onclick="window.location.href='index.html'">‚Üê Back to Evolution</button>
    </div>

    <!-- Alert Area -->
    <div id="alertArea" style="width:100%; max-width:1200px;"></div>

    <script>
        // ============================================
        // Mock Data (replace with actual API calls)
        // ============================================
        let trainingStats = {
            samples: 2847,
            files: 156,
            accuracy: 0.84,
            bestSsim: 0.921,
            mse: 0.023,
            cvScore: 0.79,
            progress: 67
        };

        let featureImportance = [
            { name: 'polygon_count', importance: 0.24 },
            { name: 'color_r_mean', importance: 0.18 },
            { name: 'area_mean', importance: 0.15 },
            { name: 'opacity_mean', importance: 0.12 },
            { name: 'x_std', importance: 0.10 },
            { name: 'aspect_ratio_mean', importance: 0.08 },
            { name: 'edge_density', importance: 0.07 },
            { name: 'y_mean', importance: 0.06 }
        ];

        let optimalParams = {
            'craquelure.density': 0.2,
            'sss.radius': 0.3,
            'sfumato.kernel': 0.4,
            'illumination.weight': 0.7,
            'age_shift.intensity': 0.4,
            'color_temp.offset': 0.5
        };

        // ============================================
        // Update UI
        // ============================================
        function updateDashboard() {
            // Training stats
            document.getElementById('sampleCount').textContent = trainingStats.samples.toLocaleString();
            document.getElementById('fileCount').textContent = trainingStats.files;
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
            document.getElementById('trainingProgress').style.width = trainingStats.progress + '%';
            document.getElementById('progressPercent').textContent = trainingStats.progress + '%';
            
            // Model performance
            document.getElementById('modelAccuracy').textContent = trainingStats.accuracy.toFixed(2);
            document.getElementById('bestSsim').textContent = trainingStats.bestSsim.toFixed(3);
            document.getElementById('modelMse').textContent = trainingStats.mse.toFixed(3);
            document.getElementById('cvScore').textContent = trainingStats.cvScore.toFixed(2);
            
            // Optimal parameters
            document.getElementById('param1').textContent = optimalParams['craquelure.density'].toFixed(1);
            document.getElementById('param2').textContent = optimalParams['sss.radius'].toFixed(1);
            document.getElementById('param3').textContent = optimalParams['sfumato.kernel'].toFixed(1);
            document.getElementById('param4').textContent = optimalParams['illumination.weight'].toFixed(1);
            document.getElementById('param5').textContent = optimalParams['age_shift.intensity'].toFixed(1);
            document.getElementById('param6').textContent = optimalParams['color_temp.offset'].toFixed(1);
            
            // Feature importance
            renderFeatureImportance();
        }

        function renderFeatureImportance() {
            const chart = document.getElementById('featureChart');
            const list = document.getElementById('featureList');
            
            // Clear
            chart.innerHTML = '';
            list.innerHTML = '';
            
            // Create bars
            const maxImportance = Math.max(...featureImportance.map(f => f.importance));
            featureImportance.forEach(f => {
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = (f.importance / maxImportance * 150) + 'px';
                bar.title = `${f.name}: ${(f.importance * 100).toFixed(1)}%`;
                chart.appendChild(bar);
                
                const item = document.createElement('div');
                item.className = 'feature-item';
                item.innerHTML = `
                    <div class="feature-name">${f.name}</div>
                    <div class="feature-value">${(f.importance * 100).toFixed(1)}%</div>
                `;
                list.appendChild(item);
            });
        }

        // ============================================
        // Actions
        // ============================================
        function showAlert(message, type = 'info') {
            const alertArea = document.getElementById('alertArea');
            const alert = document.createElement('div');
            alert.className = 'alert';
            alert.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            alertArea.appendChild(alert);
            
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }

        async function loadTrainingData() {
            showAlert('üìÇ Loading training data...');
            
            // Simulate loading
            setTimeout(() => {
                trainingStats.samples += 100;
                trainingStats.files += 5;
                trainingStats.progress = Math.min(100, trainingStats.progress + 5);
                updateDashboard();
                showAlert('‚úÖ Training data loaded successfully');
            }, 1000);
        }

        async function retrainModel() {
            showAlert('üß† Retraining model...');
            
            // Simulate training
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                document.getElementById('trainingProgress').style.width = progress + '%';
                document.getElementById('progressPercent').textContent = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Update metrics
                    trainingStats.accuracy = 0.82 + Math.random() * 0.05;
                    trainingStats.cvScore = 0.75 + Math.random() * 0.05;
                    trainingStats.mse = 0.02 + Math.random() * 0.01;
                    
                    updateDashboard();
                    showAlert('‚úÖ Model retrained successfully!');
                }
            }, 200);
        }

        async function exportModel() {
            showAlert('üì§ Exporting model...');
            
            // Create download link
            const modelData = {
                timestamp: new Date().toISOString(),
                stats: trainingStats,
                featureImportance: featureImportance,
                optimalParams: optimalParams
            };
            
            const blob = new Blob([JSON.stringify(modelData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pigment_model_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            
            showAlert('‚úÖ Model exported');
        }

        async function runInference() {
            showAlert('üé® Running inference on current genome...');
            
            // Simulate inference
            setTimeout(() => {
                // Randomize parameters slightly
                for (let key in optimalParams) {
                    optimalParams[key] = (optimalParams[key] + (Math.random() - 0.5) * 0.2).toFixed(1);
                }
                updateDashboard();
                showAlert('‚úÖ Inference complete ‚Äî new parameters suggested');
            }, 1500);
        }

        // ============================================
        // API Integration (to be implemented)
        // ============================================
        async function fetchRealData() {
            try {
                // In production, fetch from your Python backend
                // const response = await fetch('/api/training_stats');
                // const data = await response.json();
                // trainingStats = data;
                
                // For now, use mock
                updateDashboard();
            } catch (e) {
                console.log('Using mock data');
                updateDashboard();
            }
        }

        // Initialize
        fetchRealData();
        
        // Auto-refresh every 30 seconds
        setInterval(fetchRealData, 30000);
    </script>
</body>
</html>